<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>恋愛ゲーム</title>
    <!-- Google FontsからYusei Magicを読み込む -->
    <link href="https://fonts.googleapis.com/css2?family=Yusei+Magic&display=swap" rel="stylesheet">
    <style>
        /* 全体のスタイル */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Yusei Magic', sans-serif;
            background-color: #fdf6f0; /* パステルカラーの背景色 */
            color: #333;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background-color: #fdf6f0;
        }

        /* 背景画像 */
        #background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: 1;
            transition: background-image 0.5s ease-in-out;
        }

        /* キャラクター画像 */
        #character {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 30%;
            z-index: 2;
            transition: opacity 0.5s ease-in-out;
        }

        /* テキストウィンドウ */
        #text-window {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 20px;
            box-sizing: border-box;
            z-index: 3;
            font-size: 1.2em;
            border-top: 2px solid #6a0dad;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* 話者の表示 */
        #speaker {
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* テキスト表示 */
        #dialogue {
            flex: 1;
            overflow-y: auto;
            white-space: pre-wrap; /* 改行を有効に */
            position: relative;
        }

        /* 次へボタン */
        #next-button {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px 20px;
            background-color: #6a0dad;
            color: #fff;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.2s;
            display: none; /* 初期は非表示 */
        }

        #next-button:hover {
            background-color: #7a1ead;
            transform: scale(1.05);
        }

        /* 選択肢ボタン */
        .choice-button {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background-color: #fff;
            color: #6a0dad;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.2s, color 0.3s;
        }

        .choice-button:hover {
            background-color: #ffd1dc;
            transform: scale(1.05);
            color: #fff;
        }

        /* 名前入力画面 */
        #name-input-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(240, 230, 246, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 4;
            transition: opacity 0.5s ease-in-out;
        }

        #name-input-screen h1 {
            margin-bottom: 20px;
            font-size: 2.5em;
            color: #6a0dad;
            text-align: center;
        }

        #player-name {
            padding: 15px;
            font-size: 1.5em;
            border: 3px solid #6a0dad;
            border-radius: 10px;
            width: 80%;
            max-width: 300px;
            text-align: center;
            outline: none;
        }

        #start-button {
            margin-top: 30px;
            padding: 15px 30px;
            font-size: 1.5em;
            background-color: #6a0dad;
            color: #fff;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        #start-button:hover {
            background-color: #7a1ead;
            transform: scale(1.05);
        }

        /* エンディング画像 */
        #ending-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: 5;
            display: none;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        /* フェードイン効果 */
        .fade-in {
            display: block;
            opacity: 1;
        }

        /* モバイル対応 */
        @media (max-width: 768px) {
            #character {
                width: 50%;
                bottom: 25%;
            }

            #text-window {
                font-size: 1em;
                padding: 15px;
            }

            #next-button, .choice-button {
                font-size: 0.9em;
                padding: 10px 15px;
            }

            #player-name {
                font-size: 1.2em;
            }

            #start-button {
                font-size: 1.2em;
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- 背景画像 -->
        <div id="background"></div>

        <!-- キャラクター画像 -->
        <img id="character" src="" alt="Character">

        <!-- テキストウィンドウ -->
        <div id="text-window">
            <div id="speaker"></div>
            <div id="dialogue"></div>
            <button id="next-button">次へ</button>
        </div>

        <!-- 名前入力画面 -->
        <div id="name-input-screen">
            <h1>あなたの名前を入力してください</h1>
            <input type="text" id="player-name" placeholder="名前を入力">
            <button id="start-button">決定</button>
        </div>

        <!-- エンディング画像 -->
        <div id="ending-image"></div>
    </div>

    <script>
        // ゲームのシナリオデータ
        const scenes = {
            'start': {
                background: 'images/gasshou.png',
                character: '',
                speaker: '',
                lines: [
                    '（高校2年生の春…。合唱コンクールの季節だった。）',
                    '教室には、Tさんがクラスの前で指揮をとる姿があった。',
                    '彼女の声が響く。「さあ、みんな！もっと声を出して！」',
                    '僕は、教室の隅で彼女の姿をじっと見つめていた。',
                    '（あの笑顔…クラスのみんなを引っ張って、あんなに輝いてる…）',
                    'みんなが楽しそうに歌っているのに、僕はただ、Tさんに目が行く。',
                    '（どうして、こんなに目が離せないんだろう…。ただのクラスメイトなのに…。）',
                    'その瞬間、何かが心の中で弾けたようだった。',
                    '（もしかして…僕は、彼女のことが…。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'sports_festival'
                    }
                ]
            },
            'sports_festival': {
                background: 'images/koutei.png',
                character: 'images/nomal.png',
                speaker: 'Tさん',
                lines: [
                    '体育祭の日、クラスメイトたちは元気よく準備をしていた。',
                    'その中心には、やっぱりTさんがいた。',
                    '「みんな、ここに集まって！次の競技の打ち合わせをしよう！」と、Tさんの明るい声が響く。',
                    '（彼女は、本当にすごいな…。誰とでも自然に話せて、みんなをまとめる力がある。）',
                    '僕は遠くから彼女を見つめるだけだった。',
                    '（でも、僕には話しかける勇気なんてない。何を話したらいいのかさえ分からない。）',
                    'Tさんは笑顔で他のクラスメイトたちと談笑していた。',
                    '（その笑顔…いつか僕もあんな風に話せる日が来るのかな…。）'
                ],
                choices: [
                    {
                        text: '「準備、順調？」',
                        nextScene: 'sports_festival_choice1',
                        affinityChange: 10
                    },
                    {
                        text: '「楽しみだね！」',
                        nextScene: 'sports_festival_choice2',
                        affinityChange: 0
                    },
                    {
                        text: '（何も言わない）',
                        nextScene: 'sports_festival_choice3',
                        affinityChange: -10
                    }
                ]
            },
            'sports_festival_choice1': {
                background: 'images/koutei.png',
                character: 'images/nomal.png',
                speaker: '僕',
                lines: [
                    '僕: 「準備、順調？」',
                    'Tさん: 「ありがとう、○○くん！おかげでみんなも楽しく準備できてるよ！」',
                    '（少し話せた…。でも、まだ距離はある。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'sports_festival_end'
                    }
                ]
            },
            'sports_festival_choice2': {
                background: 'images/koutei.png',
                character: 'images/nomal.png',
                speaker: '僕',
                lines: [
                    '僕: 「楽しみだね！」',
                    'Tさん: 「うん！みんなで一生懸命頑張るから、きっと素敵な思い出になるよ！」',
                    '（会話が少し弾んだ気がする…。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'sports_festival_end'
                    }
                ]
            },
            'sports_festival_choice3': {
                background: 'images/koutei.png',
                character: 'images/nomal.png',
                speaker: '僕',
                lines: [
                    '僕は何も言わず、ただTさんを見つめるだけだった。',
                    'Tさんは気づいた様子で「○○くん、元気？」と微笑んでくれた。',
                    '（もう少し話せるようになりたい…。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'sports_festival_end'
                    }
                ]
            },
            'sports_festival_end': {
                background: 'images/koutei.png',
                character: 'images/nomal.png',
                speaker: '',
                lines: [
                    '体育祭は無事に成功し、クラス全員が一体感を感じることができた。',
                    'Tさんのリーダーシップが光る一日だった。',
                    '（また一つ、Tさんとの距離が縮まった気がする。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'culture_festival'
                    }
                ]
            },
            'culture_festival': {
                background: 'images/rouka.png',
                character: 'images/nomal.png',
                speaker: '',
                lines: [
                    '文化祭の準備が進む中、クラスメイトたちはそれぞれの役割に従って作業を進めていた。',
                    'Tさんは、やはり中心になってみんなを指示している。',
                    '「ねえ、○○くん！この看板を一緒に運んでくれない？」突然、Tさんが僕に話しかけた。',
                    '僕は驚きながらも「う、うん、いいよ」と答えた。',
                    '（Tさんが、僕に話しかけた…。）',
                    '彼女と一緒に看板を運びながら、なんとか会話を続けようとしたが、言葉がなかなか出てこなかった。',
                    '（どうしよう…何を話せばいいんだろう？）',
                    'Tさんが笑いながら「ありがとう！助かったよ」と言ってくれた。',
                    '（やっぱり、彼女はみんなに優しいんだ。）'
                ],
                choices: [
                    {
                        text: '「この看板、大きいね！」',
                        nextScene: 'culture_festival_choice1',
                        affinityChange: 10
                    },
                    {
                        text: '「頑張ろうね！」',
                        nextScene: 'culture_festival_choice2',
                        affinityChange: 5
                    },
                    {
                        text: '（何も言わない）',
                        nextScene: 'culture_festival_choice3',
                        affinityChange: -20
                    }
                ]
            },
            'culture_festival_choice1': {
                background: 'images/rouka.png',
                character: 'images/nomal.png',
                speaker: '僕',
                lines: [
                    '僕: 「この看板、大きいね！」',
                    'Tさん: 「うん、これで来場者にしっかりアピールできると思うの！」',
                    '（少し話せた…。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'culture_festival_end'
                    }
                ]
            },
            'culture_festival_choice2': {
                background: 'images/rouka.png',
                character: 'images/nomal.png',
                speaker: '僕',
                lines: [
                    '僕: 「頑張ろうね！」',
                    'Tさん: 「うん、一緒に頑張ろう！」',
                    '（会話が少し弾んだ気がする…。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'culture_festival_end'
                    }
                ]
            },
            'culture_festival_choice3': {
                background: 'images/rouka.png',
                character: 'images/nomal.png',
                speaker: '僕',
                lines: [
                    '僕は何も言わず、ただTさんと一緒に看板を運んだ。',
                    'Tさんは「○○くん、手伝ってくれてありがとう！」と笑顔で感謝してくれた。',
                    '（もう少し話せるようになりたい…。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'culture_festival_end'
                    }
                ]
            },
            'culture_festival_end': {
                background: 'images/rouka.png',
                character: 'images/nomal.png',
                speaker: '',
                lines: [
                    '文化祭は無事に成功し、クラス全員が達成感を味わうことができた。',
                    'Tさんの協力があったからこそ、素晴らしいイベントになった。',
                    '（また一つ、Tさんとの距離が縮まった気がする。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'table_tennis'
                    }
                ]
            },
            'table_tennis': {
                background: 'images/kyositsu.png',
                character: 'images/nomal.png',
                speaker: 'Tさん',
                lines: [
                    '体育の時間、卓球のローテーションが回ってきた。偶然、Tさんと同じコートに立つことになった。',
                    'Tさんが「○○くん、卓球得意？」と笑顔で聞いてきた。',
                    '（えっ、いきなりそんなこと聞かれるなんて…。）'
                ],
                choices: [
                    {
                        text: '「卓球、上手だね」',
                        nextScene: 'table_tennis_success',
                        affinityChange: 10
                    },
                    {
                        text: '「卓球、難しいよね」',
                        nextScene: 'table_tennis_normal',
                        affinityChange: 5
                    },
                    {
                        text: '（静かに卓球をやる）',
                        nextScene: 'table_tennis_fail',
                        affinityChange: -10
                    }
                ]
            },
            'table_tennis_success': {
                background: 'images/kyositsu.png',
                character: 'images/egao.png',
                speaker: 'Tさん',
                lines: [
                    'Tさんが笑顔で「ありがとう！でも、そんなに上手くないよ」と照れくさそうに答えた。',
                    '僕は少し緊張しながらも、会話が続いた。',
                    '（こうやって自然に話せる日が来るなんて…）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'final_week_intro'
                    }
                ]
            },
            'table_tennis_normal': {
                background: 'images/kyositsu.png',
                character: 'images/nomal.png',
                speaker: 'Tさん',
                lines: [
                    'Tさんが笑顔で「うん、確かに難しいけど、楽しいよね！」と答えた。',
                    '僕は「そうだね」と返し、会話はそれほど続かなかった。',
                    '（まだ話し足りない気がするけど、これでいいのかな…。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'final_week_intro'
                    }
                ]
            },
            'table_tennis_fail': {
                background: 'images/kyositsu.png',
                character: 'images/odoroki.png',
                speaker: 'Tさん',
                lines: [
                    'Tさんが「…（何か話しかけようとして、結局そのまま授業が終わる）」',
                    '僕は「（心の中で）うまく話しかけられなかった…」'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'final_week_intro'
                    }
                ]
            },
            'final_week_intro': {
                background: 'images/kyositsu.png',
                character: 'images/nomal.png',
                speaker: '',
                lines: [
                    '（高校生活最後の週が始まる…）',
                    'Tさんが「○○くん、最後の週だね。何か特別なこと、したい？」と笑顔で聞いてきた。',
                    '僕は「うーん、まだ決めてないけど…」と答えた。',
                    'Tさんが「私、少しだけ学校を楽しもうと思ってるんだ。一緒にどう？」と誘ってくれた。'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'final_week_monday'
                    }
                ]
            },
            'final_week_monday': {
                background: 'images/kyositsu.png',
                character: 'images/nomal.png',
                speaker: 'Tさん',
                lines: [
                    '月曜日の朝、いつもと変わらない日常が始まった。',
                    'Tさんが「おはよう！○○くん、今日も頑張ろうね」と明るく声をかけてきた。',
                    '（普通の日常のはずなのに、今日が特別な日になるかもしれない…。）',
                    '授業が終わり、ふとTさんが僕の方に近づいてきた。「今日、少しだけ話せる？」'
                ],
                choices: [
                    {
                        text: '告白する',
                        nextScene: 'confess_monday',
                        affinityChange: 10
                    },
                    {
                        text: '告白しない',
                        nextScene: 'bad_end'
                    }
                ]
            },
            'final_week_tuesday': {
                background: 'images/kyositsu.png',
                character: 'images/nomal.png',
                speaker: 'Tさん',
                lines: [
                    '火曜日の朝がやってきた。',
                    'Tさんが「○○くん、今日はどんな気分？」と元気よく話しかけてきた。',
                    '僕は「今日は少し緊張してるかな」と答えた。',
                    'Tさんが「そうなんだ。私も少し緊張してるよ。でも、一緒に頑張ろうね！」と微笑んだ。'
                ],
                choices: [
                    {
                        text: '告白する',
                        nextScene: 'confess_tuesday',
                        affinityChange: 10
                    },
                    {
                        text: '告白しない',
                        nextScene: 'bad_end'
                    }
                ]
            },
            'final_week_wednesday': {
                background: 'images/kyositsu.png',
                character: 'images/nomal.png',
                speaker: 'Tさん',
                lines: [
                    '水曜日の朝、いつもの教室。',
                    'Tさんが「○○くん、最近どうしてる？」と話しかけてきた。',
                    '僕は「元気だよ。Tさんは？」と答えた。',
                    'Tさんが「私も元気！最近、新しい趣味を始めたんだ。○○くんも何か始めてみない？」と提案してきた。'
                ],
                choices: [
                    {
                        text: '告白する',
                        nextScene: 'confess_wednesday',
                        affinityChange: 10
                    },
                    {
                        text: '告白しない',
                        nextScene: 'bad_end'
                    }
                ]
            },
            'final_week_thursday': {
                background: 'images/kyositsu.png',
                character: 'images/nomal.png',
                speaker: 'Tさん',
                lines: [
                    '木曜日の朝、Tさんが「○○くん、今日は特別な日なんだって？」と尋ねてきた。',
                    '僕は「うん、実は…」と口ごもった。',
                    'Tさんが「何？話してみて」と優しく促してくれた。'
                ],
                choices: [
                    {
                        text: '告白する',
                        nextScene: 'confess_thursday',
                        affinityChange: 10
                    },
                    {
                        text: '告白しない',
                        nextScene: 'bad_end'
                    }
                ]
            },
            'final_week_friday': {
                background: 'images/kyositsu.png',
                character: 'images/nomal.png',
                speaker: 'Tさん',
                lines: [
                    '金曜日の朝、もうすぐ卒業式が始まる。',
                    'Tさんが「○○くん、もうすぐ卒業だね。何をする予定？」と話しかけてきた。',
                    '僕は「まだ決めてないけど…」と答えた。',
                    'Tさんが「私もまだ決めてないけど、一緒に何かやろうよ」と提案してきた。'
                ],
                choices: [
                    {
                        text: '告白する',
                        nextScene: 'confess_friday',
                        affinityChange: 10
                    },
                    {
                        text: '告白しない',
                        nextScene: 'no_end'
                    }
                ]
            },
            'confess_monday': {
                background: 'images/yuyake.png',
                character: 'images/nomal.png',
                speaker: '僕',
                lines: [
                    '僕: 「このままじゃ、卒業しても後悔すると思って…ずっとTさんのことが好きだったんだ。」',
                    'Tさんは一瞬、驚いたように目を見開いたけれど、すぐに少し恥ずかしそうに笑った。',
                    'Tさん: 「…○○くん、実は私も…ずっと君のこと気になってた。でも、言えなかった…。ありがとう。」',
                    '（その言葉を聞いた瞬間、僕の胸の中で何かが溶けるような感覚が広がった。）',
                    'Tさん: 「これからも、ずっと一緒にいようね。」',
                    '夕陽が窓から差し込む教室で、僕たちは未来を見つめ合った。',
                    '「ありがとう、Tさん。これからも、ずっと君を大切にするよ。」',
                    'Tさん: 「私も…一緒に歩んでいこうね。」',
                    '（これ以上の幸せはない、そう確信した。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'happy_end'
                    }
                ]
            },
            'confess_tuesday': {
                background: 'images/yuyake.png',
                character: 'images/nomal.png',
                speaker: '僕',
                lines: [
                    '僕: 「Tさん、ずっと君のことが好きだったんだ。」',
                    'Tさんは少し困ったような表情を浮かべた。',
                    '「…○○くん、ごめんね。そんな風に考えたことはなかったの。」',
                    '心に冷たい風が吹いたような感覚がした。それでも、Tさんは優しい声で「これからも友達でいようね」と言ってくれた。',
                    '僕は無理に笑顔を作り、「そうだね、ありがとう」と答えた。'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'bad_end'
                    }
                ]
            },
            'confess_wednesday': {
                background: 'images/yuyake.png',
                character: 'images/nomal.png',
                speaker: '僕',
                lines: [
                    '僕: 「Tさん、実は…君のことが好きです。」',
                    'Tさんは一瞬黙り込んだが、優しい笑顔で「○○くん、私も同じ気持ちだった。でも、言い出せなくて…」と答えてくれた。',
                    'その瞬間、僕の心は温かく満たされた。',
                    '「本当に…？」と驚きと喜びを込めて尋ねると、Tさんは頷いた。',
                    '「うん、これからも一緒にいようね。」'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'happy_end'
                    }
                ]
            },
            'confess_thursday': {
                background: 'images/yuyake.png',
                character: 'images/nomal.png',
                speaker: '僕',
                lines: [
                    '僕: 「Tさん、ずっと君に伝えたかったんだ。好きです。」',
                    'Tさんは少し驚いた表情を浮かべたが、すぐに穏やかな笑顔を見せた。',
                    '「○○くん、私も同じ気持ちだった。でも、もうすぐ卒業だから…」',
                    '僕は「でも、今伝えなきゃ後悔すると思ったんだ」と言い、Tさんの手を握った。',
                    'Tさんは「ありがとう、○○くん。私もこれから一緒に歩んでいきたい」と答えてくれた。'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'happy_end'
                    }
                ]
            },
            'confess_friday': {
                background: 'images/yuyake.png',
                character: 'images/nomal.png',
                speaker: '僕',
                lines: [
                    '僕: 「このままじゃ、卒業しても後悔すると思って…ずっとTさんのことが好きだったんだ。」',
                    'Tさんは一瞬、驚いたように目を見開いたが、すぐに優しい笑顔を見せた。',
                    '「私も、ずっと○○くんのこと気になってた。でも、言えなくて…。ありがとう。」',
                    'その瞬間、僕の心は安堵と喜びで満たされた。',
                    '「本当に…？」と尋ねると、Tさんは頷きながら「うん、これからも一緒にいようね」と答えてくれた。',
                    '夕陽が窓から差し込む教室で、僕たちは未来を見つめ合った。この瞬間が、これからの僕たちの始まりだと確信した。',
                    '「ありがとう、Tさん。これからも、ずっと君を大切にするよ。」',
                    'Tさん: 「私も…一緒に歩んでいこうね。」',
                    '（これ以上の幸せはない、そう確信した。）'
                ],
                choices: [
                    {
                        text: '次へ',
                        nextScene: 'happy_end'
                    }
                ]
            },
            'happy_end': {
                background: 'images/happyend.png',
                character: '',
                speaker: '',
                lines: [
                    '（告白が成功し、Tさんと正式に付き合うことになった。二人は卒業後も一緒に歩んでいくことを誓い合う。）'
                ],
                choices: [
                    {
                        text: 'ゲーム終了',
                        nextScene: null
                    }
                ]
            },
            'bad_end': {
                background: 'images/badend.png',
                character: '',
                speaker: '',
                lines: [
                    '（告白をしなかったため、Tさんは勉強のために学校に来なくなり、別れを迎える。主人公は後悔と寂しさを感じながら卒業を迎える。）'
                ],
                choices: [
                    {
                        text: 'ゲーム終了',
                        nextScene: null
                    }
                ]
            },
            'no_end': {
                background: 'images/noend.png',
                character: '',
                speaker: '',
                lines: [
                    '（告白をしなかったため、Tさんとの関係は自然と疎遠になり、卒業を迎える。主人公は自分の気持ちに気づかなかったことを後悔する。）'
                ],
                choices: [
                    {
                        text: 'ゲーム終了',
                        nextScene: null
                    }
                ]
            }
        };

        let currentScene = 'start';
        let currentLine = 0;
        let playerName = '';
        let affinity = 50; // 初期好感度
        let confessionFailed = false; // 告白失敗条件

        const background = document.getElementById('background');
        const character = document.getElementById('character');
        const speaker = document.getElementById('speaker');
        const dialogue = document.getElementById('dialogue');
        const nextButton = document.getElementById('next-button');
        const nameInputScreen = document.getElementById('name-input-screen');
        const playerNameInput = document.getElementById('player-name');
        const startButton = document.getElementById('start-button');
        const endingImage = document.getElementById('ending-image');

        // テキスト表示の速度（ミリ秒）
        const textSpeed = 30;
        let isTyping = false;
        let typingTimeout;

        // ゲーム開始ボタンのイベントリスナー
        startButton.addEventListener('click', () => {
            const name = playerNameInput.value.trim();
            if (name === '') {
                alert('名前を入力してください。');
                return;
            }
            playerName = name;
            nameInputScreen.style.display = 'none';
            loadScene(currentScene);
        });

        // シーンをロードする関数
        function loadScene(sceneId) {
            currentScene = sceneId;
            currentLine = 0;
            renderScene();
        }

        // シーンをレンダリングする関数
        function renderScene() {
            const scene = scenes[currentScene];
            if (!scene) {
                console.error('シーンが見つかりません:', currentScene);
                return;
            }

            // 背景画像を設定
            background.style.backgroundImage = `url('${scene.background}')`;

            // キャラクター画像を設定
            if (scene.character) {
                character.src = scene.character;
                character.style.display = 'block';
            } else {
                character.style.display = 'none';
            }

            // 話者を設定
            speaker.textContent = scene.speaker;

            // ダイアログをクリア
            dialogue.innerHTML = '';
            // 次へボタンを非表示
            nextButton.style.display = 'none';
            // 選択肢コンテナがあれば削除
            const existingChoices = document.getElementById('choices-container');
            if (existingChoices) {
                existingChoices.remove();
            }

            // 会話を開始
            showNextLine();
        }

        // 次のセリフを表示する関数
        function showNextLine() {
            const scene = scenes[currentScene];
            if (currentLine < scene.lines.length) {
                const line = scene.lines[currentLine];
                typeWriter(line, () => {
                    currentLine++;
                    // 次のセリフがある場合はNextボタンを表示
                    if (currentLine < scene.lines.length) {
                        nextButton.style.display = 'block';
                    } else {
                        // 選択肢を表示
                        displayChoices();
                    }
                });
            }
        }

        // タイプライター効果でテキストを表示する関数
        function typeWriter(text, callback) {
            isTyping = true;
            dialogue.innerHTML = '';
            let i = 0;
            function type() {
                if (i < text.length) {
                    dialogue.innerHTML += text.charAt(i);
                    i++;
                    typingTimeout = setTimeout(type, textSpeed);
                } else {
                    isTyping = false;
                    if (callback) callback();
                }
            }
            type();
        }

        // Nextボタンのイベントリスナー
        nextButton.addEventListener('click', () => {
            if (isTyping) return;
            nextButton.style.display = 'none';
            showNextLine();
        });

        // 選択肢を表示する関数
        function displayChoices() {
            const scene = scenes[currentScene];
            if (scene.choices && scene.choices.length > 0) {
                nextButton.style.display = 'none';
                const choicesContainer = document.createElement('div');
                choicesContainer.id = 'choices-container';
                scene.choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.classList.add('choice-button');
                    button.textContent = choice.text;
                    button.addEventListener('click', () => {
                        handleChoice(choice);
                    });
                    choicesContainer.appendChild(button);
                });
                document.getElementById('text-window').appendChild(choicesContainer);
            }
        }

        // 選択肢を処理する関数
        function handleChoice(choice) {
            // 好感度を変更
            affinity += choice.affinityChange;

            // 特殊条件のチェック
            if (choice.nextScene.startsWith('confess')) {
                if (affinity < 30 || (affinity <= 40 && choice.text.includes('しない'))) {
                    confessionFailed = true;
                }
            }

            // 告白失敗条件のチェック
            if (affinity < 30 || (affinity <= 40 && choice.text.includes('しない'))) {
                confessionFailed = true;
            }

            // 最終週の告白条件
            if (currentScene.startsWith('final_week') && choice.text === '告白する') {
                if (affinity > 75 && !confessionFailed) {
                    // 告白成功
                    loadScene('happy_end');
                } else {
                    // 告白失敗
                    loadScene('bad_end');
                }
                return;
            }

            // 次のシーンに進む
            loadScene(choice.nextScene);
        }

        // エンディングの表示
        function showEnding(sceneId) {
            const scene = scenes[sceneId];
            if (!scene) {
                console.error('エンディングシーンが見つかりません:', sceneId);
                return;
            }

            // 背景画像を設定
            background.style.backgroundImage = `url('${scene.background}')`;
            // キャラクターを非表示
            character.style.display = 'none';
            // 話者をクリア
            speaker.textContent = '';

            // ダイアログをクリア
            dialogue.innerHTML = '';
            // 選択肢をクリア
            const existingChoices = document.getElementById('choices-container');
            if (existingChoices) {
                existingChoices.remove();
            }

            // エンディングを表示
            showNextLine();

            // エンディング終了時のボタン
            const endButton = document.createElement('button');
            endButton.classList.add('choice-button');
            endButton.textContent = 'ゲーム終了';
            endButton.addEventListener('click', () => {
                location.reload(); // ゲームをリロード
            });
            document.getElementById('text-window').appendChild(endButton);
        }

        // 初期シーンのロード
        loadScene(currentScene);
    </script>
</body>
</html>
